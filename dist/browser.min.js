parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"iJA9":[function(require,module,exports) {
var n=":::",a={name:"sha-1"},e={name:"AES-CBC",length:256},A={name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},o={production:"https://api.didww.com/v3/public_keys",sandbox:"https://api-sandbox.didww.com/v3/public_keys"};module.exports={SEPARATOR:n,FINGERPRINT_ALGO:a,SYM_ALGO:e,ASYM_ALGO:A,URLS:o};
},{}],"Focm":[function(require,module,exports) {
var n=require("./constants"),t=n.SEPARATOR,r=n.FINGERPRINT_ALGO,e=n.SYM_ALGO,u=n.ASYM_ALGO,o=n.URLS;function i(n){this.toString=function(){return n},this.toFile=function(t){return w(n,t||"file.enc","text/plain")},this.toArrayBuffer=function(){return s(n)}}function c(n){console&&console.error&&console.error(n)}function a(n){return fetch(n).then(function(n){return n.json()}).then(function(n){return n.data.map(function(n){return n.attributes.key})})}function f(n,t){var r=s(n);return crypto.subtle.digest.bind(crypto.subtle,t)(r).then(function(n){return y(n)})}function l(n){var e=n.map(function(n){return v(n)}),u=[];return f(atob(e[0]),r).then(function(n){return u.push(n)}).then(function(n){return f(atob(e[1]),r)}).then(function(n){return u.push(n)}).then(function(n){return u.join(t)})}function s(n){for(var t=new ArrayBuffer(n.length),r=new Uint8Array(t),e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return t}function h(n){var t=n.match(/.{1,2}/g).map(function(n){return parseInt(n,16)});return new Uint8Array(t).buffer}function p(n){return new Uint8Array(n).reduce(function(n,t){return n+String.fromCharCode(t)},"")}function y(n){return new Uint8Array(n).reduce(function(n,t){var r=t.toString(16);return 1===r.length&&(r="0"+r),n+r},"")}var w=function(n,t,r){if(window&&window.navigator&&window.navigator.msSaveBlob){var e=new Blob([n],{type:r});return e.lastModifiedDate=new Date,e.name=t,e}return new File([n],t,{type:r,lastModified:new Date})};function b(n){return new Promise(function(t,r){var e=new FileReader;e.onload=function(){return t(e.result)},e.onerror=function(){return r(e.error)},e.readAsDataURL(n)})}function d(){return crypto.subtle.generateKey(e,!0,["encrypt","decrypt"]).then(function(n){return crypto.subtle.exportKey("raw",n).then(function(n){return y(n)})})}function m(n,r){var u=h(n),o=crypto.getRandomValues(new Uint8Array(16)),i="0".repeat(16);return crypto.subtle.importKey("raw",u,{name:e.name},!1,["encrypt","decrypt"]).then(function(u){return crypto.subtle.encrypt({name:e.name,iv:o},u,s(r)).then(function(r){var e=btoa(i+p(r));return{key:[n,y(o.buffer)].join(t),content:e}})})}function v(n){return"\n"!==n[n.length-1]&&(n+="\n"),n.split("\n").slice(1,-2).join("")}function A(n,t){var r=v(n);return crypto.subtle.importKey("spki",s(atob(r)),u,!1,["encrypt"]).then(function(n){return crypto.subtle.encrypt({name:u.name,hash:u.hash},n,s(t)).then(function(n){return btoa(p(n))}).catch(function(n){return c("Failed to encrypt with RSA pubKey",n),null})}).catch(function(n){return c("Failed to import RSA pubKey",n),null})}function g(n){var r=this;n||(n={});var e=n.environment||"sandbox",u=n.url||o[e],c=null,f=null,s=null;if("test"===e){if(!(f=n.publicKeys)||!f[0]||!f[1])throw"pass publicKeys as an array of 2 public keys"}else if(!u)throw"pass valid environment or url";this.getPublicKeys=function(){return f?new Promise(function(n){return n(f)}):c?new Promise(function(n){return n(c)}):a(u).then(function(n){return c=n})},this.getFingerprint=function(){return s?new Promise(function(n){return n(s)}):r.getPublicKeys().then(function(n){return l(n)}).then(function(n){return s=n})},this.clearCache=function(){c=null,s=null},this.encryptContent=function(n){var e=null,u=null,o=null,c=null,a=[];return r.getPublicKeys().then(function(n){return e=n}).then(function(n){return d().then(function(n){return u=n})}).then(function(t){return m(u,n).then(function(n){o=n.content,c=n.key})}).then(function(n){return A(e[0],c).then(function(n){return a.push(n)})}).then(function(n){return A(e[1],c).then(function(n){return a.push(n)})}).then(function(n){return new i(a.concat(o).join(t))})},this.encryptFile=function(n){return b(n).then(r.encryptContent)},this.encryptArrayBuffer=function(n){var t=p(n);return r.encryptContent(t)}}g.DidwwEncryptedFile=i,g.SYM_ALGO=e,g.ASYM_ALGO=u,module.exports=g;
},{"./constants":"iJA9"}],"hpaf":[function(require,module,exports) {
window.DidwwEncrypt=require("./index");
},{"./index":"Focm"}]},{},["hpaf"], null);
//# sourceMappingURL=/browser.min.js.map
